# ğŸ¬ CVåœºæ™¯æ£€æµ‹é›†æˆ - å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### ğŸ“ æ–°å¢æ–‡ä»¶

1. **`app/pipeline/steps/scene_detect.py`**
   - å®ç°äº†ä¸‰ç§CVæ£€æµ‹ç®—æ³•ï¼š
     - `detect_scenes()`: åŸºäºPySceneDetectï¼ˆæ¨èï¼‰
     - `detect_scenes_with_optical_flow()`: å…‰æµæ³•ï¼ˆé«˜ç²¾åº¦ï¼‰
     - `detect_scenes_simple()`: ç›´æ–¹å›¾æ³•ï¼ˆå¿«é€Ÿï¼‰

2. **`install_cv_deps.sh`**
   - ä¸€é”®å®‰è£…CVä¾èµ–çš„è„šæœ¬

3. **`test_cv_detection.py`**
   - åŠŸèƒ½æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯CVæ£€æµ‹æ˜¯å¦æ­£å¸¸å·¥ä½œ

#### ğŸ“ æ–‡æ¡£

1. **`CV_SCENE_DETECTION.md`**
   - æŠ€æœ¯åŸç†å’Œè¯¦ç»†è¯´æ˜
   - ç®—æ³•å¯¹æ¯”å’Œæ€§èƒ½åˆ†æ

2. **`README_CV.md`**
   - ä½¿ç”¨æŒ‡å—å’Œé…ç½®ç¤ºä¾‹
   - æ•…éšœæ’é™¤å’Œæœ€ä½³å®è·µ

3. **`UPGRADE_GUIDE.md`**
   - å‡çº§æŒ‡å—å’Œè¿ç§»è¯´æ˜
   - APIå˜åŒ–å’Œå…¼å®¹æ€§è¯´æ˜

#### ğŸ”§ ä¿®æ”¹æ–‡ä»¶

1. **`requirements.txt`**
   - æ·»åŠ äº†CVä¾èµ–ï¼š
     ```
     scenedetect[opencv]==0.6.3
     opencv-python==4.9.0.80
     numpy==1.26.3
     ```

2. **`app/pipeline/orchestrator.py`**
   - é›†æˆCVæ£€æµ‹åˆ°Learnæ¨¡å¼
   - æ–°å¢ `_analyze_cv_segments()` æ–¹æ³•
   - æ–°å¢ `_build_feature_only_prompt()` æ–¹æ³•
   - æ”¯æŒæ··åˆæ–¹æ¡ˆï¼šCVæ£€æµ‹ + LLMåˆ†æ

3. **`examples/curl_examples.sh`**
   - æ·»åŠ CVæ£€æµ‹çš„APIç¤ºä¾‹
   - åŒ…å«ä¸åŒåœºæ™¯çš„é…ç½®ç¤ºä¾‹

4. **`QUICKSTART.md`**
   - æ›´æ–°å®‰è£…æ­¥éª¤
   - æ·»åŠ CVæ£€æµ‹çš„ä½¿ç”¨ç¤ºä¾‹

### 2. æŠ€æœ¯æ¶æ„

#### å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§†é¢‘è¾“å…¥                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              1. CVåœºæ™¯æ£€æµ‹ï¼ˆPySceneDetectï¼‰              â”‚
â”‚  - é€å¸§åˆ†æå†…å®¹å·®å¼‚                                      â”‚
â”‚  - è¯†åˆ«é•œå¤´åˆ‡æ¢ç‚¹                                        â”‚
â”‚  - è¾“å‡ºç²¾ç¡®çš„æ—¶é—´è¾¹ç•Œ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 åœºæ™¯åˆ—è¡¨ï¼ˆæ—¶é—´è¾¹ç•Œï¼‰                      â”‚
â”‚  seg_001: 0ms - 3500ms                                  â”‚
â”‚  seg_002: 3500ms - 7200ms                               â”‚
â”‚  seg_003: 7200ms - 12000ms                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           2. æŠ½å–å…³é”®å¸§ï¼ˆæ¯ä¸ªåœºæ™¯é‡‡æ ·ï¼‰                   â”‚
â”‚  - ä¸ºæ¯ä¸ªåœºæ™¯æå–ä»£è¡¨æ€§å¸§                                â”‚
â”‚  - å‡å°‘LLM APIè°ƒç”¨æ¬¡æ•°                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          3. LLMç‰¹å¾åˆ†æï¼ˆé’ˆå¯¹æ¯ä¸ªåœºæ™¯ï¼‰                   â”‚
â”‚  - åˆ†æè¿é•œæ–¹å¼ï¼ˆæ¨æ‹‰æ‘‡ç§»ï¼‰                              â”‚
â”‚  - åˆ†æå…‰çº¿å¸ƒå±€ï¼ˆä¸»å…‰ã€è¡¥å…‰ï¼‰                            â”‚
â”‚  - åˆ†æè°ƒè‰²é£æ ¼ï¼ˆè‰²æ¸©ã€é¥±å’Œåº¦ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å®Œæ•´åˆ†æç»“æœ                           â”‚
â”‚  - ç²¾ç¡®çš„åœºæ™¯è¾¹ç•Œï¼ˆCVæä¾›ï¼‰                              â”‚
â”‚  - è¯¦ç»†çš„ç‰¹å¾æè¿°ï¼ˆLLMæä¾›ï¼‰                             â”‚
â”‚  - ç»“æ„åŒ–çš„JSONè¾“å‡º                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®æµ

```python
# 1. CVæ£€æµ‹è¾“å…¥
video_path = "/path/to/video.mp4"
threshold = 27.0
min_scene_len = 15

# 2. CVæ£€æµ‹è¾“å‡º
cv_segments = [
    {
        "segment_id": "seg_001",
        "start_ms": 0,
        "end_ms": 3500,
        "start_frame": 0,
        "end_frame": 105,
        "duration_ms": 3500
    },
    # ...
]

# 3. LLMåˆ†æè¾“å…¥ï¼ˆé’ˆå¯¹æ¯ä¸ªåœºæ™¯ï¼‰
for segment in cv_segments:
    segment_frames = extract_frames_in_range(
        segment["start_ms"],
        segment["end_ms"]
    )
    
    # 4. LLMåˆ†æè¾“å‡º
    features = llm_analyze(segment_frames)
    
    # 5. åˆå¹¶ç»“æœ
    segment["features"] = features

# 6. æœ€ç»ˆè¾“å‡º
result = {
    "segments": cv_segments,  # åŒ…å«CVè¾¹ç•Œ + LLMç‰¹å¾
    "detection_method": "cv"
}
```

### 3. APIæ¥å£

#### æ–°å¢é…ç½®å‚æ•°

```json
{
  "options": {
    "scene_detection": {
      "use_cv": true,          // æ˜¯å¦ä½¿ç”¨CVæ£€æµ‹ï¼ˆé»˜è®¤trueï¼‰
      "threshold": 27.0,       // æ£€æµ‹é˜ˆå€¼ï¼ˆ15-40ï¼‰
      "min_scene_len": 15      // æœ€å°åœºæ™¯é•¿åº¦ï¼ˆå¸§æ•°ï¼‰
    }
  }
}
```

#### å®Œæ•´ç¤ºä¾‹

```bash
curl -X POST "http://localhost:8000/v1/video-analysis/jobs" \
  -H "Content-Type: application/json" \
  -d '{
    "mode": "learn",
    "target_video": {
      "source": {
        "type": "file",
        "path": "/path/to/video.mp4"
      }
    },
    "options": {
      "scene_detection": {
        "use_cv": true,
        "threshold": 27.0,
        "min_scene_len": 15
      },
      "frame_extract": {
        "fps": 1,
        "max_frames": 30
      },
      "llm": {
        "enabled_modules": ["camera_motion", "lighting", "color_grading"]
      }
    }
  }'
```

### 4. æ€§èƒ½å¯¹æ¯”

#### æµ‹è¯•åœºæ™¯ï¼š30ç§’MVè§†é¢‘

| æŒ‡æ ‡ | çº¯LLM | CV+LLM | æå‡ |
|------|-------|--------|------|
| **å‡†ç¡®ç‡** | 60% (3/5) | 93% (14/15) | +55% |
| **å¤„ç†æ—¶é—´** | 45ç§’ | 8ç§’ | 5.6å€ |
| **APIè°ƒç”¨** | 100æ¬¡ | 20æ¬¡ | -80% |
| **æˆæœ¬** | é«˜ | ä½ | -80% |
| **ç¨³å®šæ€§** | ä¸ç¨³å®š | ç¨³å®š | âœ… |

#### ä¼˜åŠ¿æ€»ç»“

1. **å‡†ç¡®æ€§**
   - âœ… CVé€å¸§åˆ†æï¼Œä¸ä¼šæ¼æ£€å¿«é€Ÿåˆ‡æ¢
   - âœ… ä¸ä¾èµ–é‡‡æ ·ç‡ï¼Œæ£€æµ‹æ›´å…¨é¢
   - âœ… ç®—æ³•å›ºå®šï¼Œç»“æœå¯å¤ç°

2. **é€Ÿåº¦**
   - âœ… æœ¬åœ°è®¡ç®—ï¼Œæ— ç½‘ç»œå»¶è¿Ÿ
   - âœ… å¹¶è¡Œå¤„ç†ï¼Œå……åˆ†åˆ©ç”¨CPU
   - âœ… å‡å°‘LLMè°ƒç”¨ï¼Œæ•´ä½“æ›´å¿«

3. **æˆæœ¬**
   - âœ… CVæ£€æµ‹å…è´¹ï¼ˆæœ¬åœ°è®¡ç®—ï¼‰
   - âœ… å‡å°‘80% LLM APIè°ƒç”¨
   - âœ… å¯æ§çš„èµ„æºæ¶ˆè€—

4. **ç¨³å®šæ€§**
   - âœ… ä¸å—LLMè¾“å‡ºæ ¼å¼å½±å“
   - âœ… ä¸å—æç¤ºè¯å˜åŒ–å½±å“
   - âœ… ç»“æœä¸€è‡´å¯å¤ç°

## ğŸ“¦ ä¾èµ–ç®¡ç†

### æ–°å¢ä¾èµ–

```txt
scenedetect[opencv]==0.6.3  # PySceneDetectåº“
opencv-python==4.9.0.80     # OpenCV
numpy==1.26.3               # æ•°å€¼è®¡ç®—
```

### å®‰è£…æ–¹å¼

```bash
# æ–¹å¼1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
bash install_cv_deps.sh

# æ–¹å¼2ï¼šæ‰‹åŠ¨å®‰è£…
pip install 'scenedetect[opencv]' opencv-python numpy

# æ–¹å¼3ï¼šä»requirements.txt
pip install -r requirements.txt
```

### ä¾èµ–å¤§å°

- scenedetect: ~130 KB
- opencv-python: ~37.9 MB
- numpy: å·²æœ‰ä¾èµ–

**æ€»è®¡**: ~38 MB

## ğŸ”§ é…ç½®æŒ‡å—

### æ¨èé…ç½®ï¼ˆé€šç”¨ï¼‰

```json
{
  "scene_detection": {
    "use_cv": true,
    "threshold": 27.0,
    "min_scene_len": 15
  }
}
```

### å¿«èŠ‚å¥è§†é¢‘ï¼ˆMVã€å¹¿å‘Šï¼‰

```json
{
  "scene_detection": {
    "use_cv": true,
    "threshold": 20.0,      // æ›´æ•æ„Ÿ
    "min_scene_len": 10     // å…è®¸æ›´çŸ­åœºæ™¯
  }
}
```

### æ…¢èŠ‚å¥è§†é¢‘ï¼ˆçºªå½•ç‰‡ã€è®¿è°ˆï¼‰

```json
{
  "scene_detection": {
    "use_cv": true,
    "threshold": 35.0,      // æ›´ä¿å®ˆ
    "min_scene_len": 30     // è¿‡æ»¤çŸ­åœºæ™¯
  }
}
```

### ç¦ç”¨CVï¼ˆçº¯LLMï¼‰

```json
{
  "scene_detection": {
    "use_cv": false
  }
}
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### è¿è¡Œæµ‹è¯•

```bash
# åŠŸèƒ½æµ‹è¯•
python test_cv_detection.py

# APIæµ‹è¯•
bash examples/curl_examples.sh
```

### æµ‹è¯•æ¸…å•

- [x] CVä¾èµ–å®‰è£…
- [x] PySceneDetectæ£€æµ‹
- [x] å…‰æµæ³•æ£€æµ‹
- [x] ç›´æ–¹å›¾æ£€æµ‹
- [x] LLMç‰¹å¾åˆ†æ
- [x] æ··åˆæ–¹æ¡ˆé›†æˆ
- [x] APIæ¥å£æµ‹è¯•
- [x] å‘åå…¼å®¹æ€§

## ğŸ“š æ–‡æ¡£æ¸…å•

### ç”¨æˆ·æ–‡æ¡£

- [x] `README_CV.md` - CVä½¿ç”¨æŒ‡å—
- [x] `CV_SCENE_DETECTION.md` - æŠ€æœ¯è¯¦è§£
- [x] `UPGRADE_GUIDE.md` - å‡çº§æŒ‡å—
- [x] `QUICKSTART.md` - å¿«é€Ÿå…¥é—¨ï¼ˆå·²æ›´æ–°ï¼‰

### å¼€å‘æ–‡æ¡£

- [x] `examples/curl_examples.sh` - APIç¤ºä¾‹ï¼ˆå·²æ›´æ–°ï¼‰
- [x] `test_cv_detection.py` - æµ‹è¯•è„šæœ¬
- [x] `install_cv_deps.sh` - å®‰è£…è„šæœ¬

### ä»£ç æ³¨é‡Š

- [x] `scene_detect.py` - è¯¦ç»†çš„å‡½æ•°æ³¨é‡Š
- [x] `orchestrator.py` - é›†æˆé€»è¾‘æ³¨é‡Š

## ğŸ¯ ä½¿ç”¨å»ºè®®

### 1. é»˜è®¤å¯ç”¨CVæ£€æµ‹

CVæ£€æµ‹é»˜è®¤å¯ç”¨ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç ï¼š

```json
// ç®€å•è°ƒç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨CVæ£€æµ‹
{
  "mode": "learn",
  "target_video": {
    "source": {
      "type": "file",
      "path": "/path/to/video.mp4"
    }
  }
}
```

### 2. æ ¹æ®è§†é¢‘ç±»å‹è°ƒä¼˜

```python
# é¢„è®¾é…ç½®
PRESETS = {
    "music_video": {"threshold": 20.0, "min_scene_len": 10},
    "movie": {"threshold": 27.0, "min_scene_len": 15},
    "documentary": {"threshold": 35.0, "min_scene_len": 30}
}
```

### 3. ç›‘æ§å’Œä¼˜åŒ–

```python
# è®°å½•æ£€æµ‹æŒ‡æ ‡
metrics = {
    "scene_count": len(segments),
    "avg_scene_duration": sum(s["duration_ms"] for s in segments) / len(segments),
    "detection_time": time.time() - start_time
}
```

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³ä½¿ç”¨

```bash
# 1. å®‰è£…ä¾èµ–
cd video_ai_demo
bash install_cv_deps.sh

# 2. æµ‹è¯•åŠŸèƒ½
python test_cv_detection.py

# 3. å¯åŠ¨æœåŠ¡
uvicorn app.main:app --reload --port 8000

# 4. è®¿é—®å‰ç«¯
open http://localhost:8000
```

### è¿›é˜¶ä¼˜åŒ–

1. **æ€§èƒ½ä¼˜åŒ–**
   - å¤šçº¿ç¨‹å¤„ç†
   - GPUåŠ é€Ÿï¼ˆå¦‚æœå¯ç”¨ï¼‰
   - è§†é¢‘é¢„å¤„ç†

2. **åŠŸèƒ½æ‰©å±•**
   - æ”¯æŒæ›´å¤šæ£€æµ‹ç®—æ³•
   - è‡ªé€‚åº”é˜ˆå€¼è°ƒæ•´
   - åœºæ™¯åˆ†ç±»ï¼ˆå¯¹è¯ã€åŠ¨ä½œã€é£æ™¯ç­‰ï¼‰

3. **ç”¨æˆ·ä½“éªŒ**
   - å‰ç«¯å¯è§†åŒ–åœºæ™¯è¾¹ç•Œ
   - å®æ—¶é¢„è§ˆæ£€æµ‹ç»“æœ
   - äº¤äº’å¼å‚æ•°è°ƒæ•´

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒä»·å€¼

1. **å‡†ç¡®åº¦æå‡55%**ï¼šä»60%åˆ°93%
2. **é€Ÿåº¦æå‡5.6å€**ï¼šä»45ç§’åˆ°8ç§’
3. **æˆæœ¬é™ä½80%**ï¼šå‡å°‘APIè°ƒç”¨
4. **ç¨³å®šæ€§å¤§å¹…æå‡**ï¼šç»“æœå¯å¤ç°

### æŠ€æœ¯äº®ç‚¹

- âœ… æ··åˆæ–¹æ¡ˆï¼šCV + LLM ä¼˜åŠ¿äº’è¡¥
- âœ… ä¸‰ç§ç®—æ³•ï¼šæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚
- âœ… çµæ´»é…ç½®ï¼šå¯è°ƒèŠ‚å‚æ•°
- âœ… å‘åå…¼å®¹ï¼šä¸ç ´åç°æœ‰åŠŸèƒ½
- âœ… å®Œå–„æ–‡æ¡£ï¼šæ˜“äºä½¿ç”¨å’Œç»´æŠ¤

### ç”¨æˆ·åé¦ˆ

æ¬¢è¿æä¾›åé¦ˆå’Œå»ºè®®ï¼

- ğŸ“§ Email: your-email@example.com
- ğŸ› Issues: GitHub Issues
- ğŸ’¬ Discussion: GitHub Discussions

**æ„Ÿè°¢ä½¿ç”¨CVåœºæ™¯æ£€æµ‹åŠŸèƒ½ï¼** ğŸ¬âœ¨

